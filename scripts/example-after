#!/usr/bin/env fish
# Post-deployment script - runs after config stowing
# Processes placeholders in config files using module parameters

# Available environment variables:
# - $FEDPUNK_ROOT: Fedpunk installation directory
# - $MODULE_NAME: Current module name
# - $MODULE_DIR: Module directory path
# - $HOME: User home directory
# - $FEDPUNK_PARAM_TEMPLATE_EXAMPLE_VALUE: Module parameter

# Use fedpunk UI library for consistent output
source "$FEDPUNK_ROOT/lib/fish/ui.fish"

ui-info "Configuring template module..."

# Get parameter value (with fallback to default)
set -l param_value "Hello from template module!"
if set -q FEDPUNK_PARAM_TEMPLATE_EXAMPLE_VALUE
    set param_value $FEDPUNK_PARAM_TEMPLATE_EXAMPLE_VALUE
end

# Replace placeholder in stowed config file
set -l config_file "$HOME/.config/template/config.conf"

if test -f "$config_file"
    sed -i "s|{{PLACEHOLDER}}|$param_value|g" "$config_file"
    ui-success "Configured example_value: $param_value"
else
    ui-error "Config file not found: $config_file"
    exit 1
end

ui-success "Template module setup complete"
